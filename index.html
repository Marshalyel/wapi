<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cuaca Terkini Berbagai Lokasi</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background:#e0f2f7; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; color:#333;}
    .container { background:#fff; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.1); padding:30px 40px; text-align:center; width:90%; max-width:500px; box-sizing:border-box;}
    h1 { color:#007bb5; margin-bottom:20px; font-size:2em; }
    #location-select { padding:10px 15px; border-radius:8px; border:1px solid #ccc; margin-bottom:25px; font-size:1em; width:100%; max-width:300px; background:#f8f8f8; cursor:pointer; }
    #weather-info p { font-size:1.1em; margin:10px 0; }
    #weather-info strong { color:#005f88; }
    .loading { font-style:italic; color:#777; }
    .error { color:#d9534f; font-weight:bold; }
    .footer { margin-top:30px; font-size:0.8em; color:#888; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cuaca Terkini di <span id="current-location-display"></span></h1>
    <select id="location-select">
      <option value="">Pilih Lokasi...</option>
    </select>
    <div id="weather-info">
      <p class="loading">Pilih lokasi untuk melihat data cuaca.</p>
    </div>
    <div class="footer">
      <p>Sumber data: BMKG (Badan Meteorologi, Klimatologi, dan Geofisika)</p>
      <p>Terakhir diperbarui: <span id="last-updated">Belum diketahui</span></p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const API_BASE_URL = './api/';
      const locationSelect = document.getElementById('location-select');
      const weatherInfoDiv = document.getElementById('weather-info');
      const lastUpdatedSpan = document.getElementById('last-updated');
      const currentLocationDisplay = document.getElementById('current-location-display');

      async function loadLocations() {
        try {
          const resp = await fetch(API_BASE_URL + 'locations.json');
          if (!resp.ok) throw new Error('Gagal memuat daftar lokasi');
          const locs = await resp.json();
          locs.forEach(l => {
            const opt = document.createElement('option');
            opt.value = l.id; opt.textContent = l.name;
            locationSelect.appendChild(opt);
          });
          const hashId = window.location.hash.substring(1);
          if (hashId && locs.some(l=>l.id===hashId)) locationSelect.value = hashId;
          fetchWeather(locationSelect.value || locs[0].id);
        } catch (e) { console.error(e); weatherInfoDiv.innerHTML='<p class="error">Gagal memuat lokasi</p>'; }
      }

      async function fetchWeather(id) {
        if(!id) return;
        const name = locationSelect.querySelector(`option[value="${id}"]`).textContent;
        currentLocationDisplay.textContent = name;
        weatherInfoDiv.innerHTML=`<p class="loading">Memuat data cuaca untuk ${name}...</p>`;
        lastUpdatedSpan.textContent='Memuat...';
        try {
          const resp = await fetch(API_BASE_URL+id+'.json');
          if(!resp.ok) throw new Error('Gagal ambil data cuaca');
          const data = await resp.json();
          weatherInfoDiv.innerHTML=`
            <p>Suhu: <strong>${data.current.temperature}</strong></p>
            <p>Kelembapan: <strong>${data.current.humidity}</strong></p>
            <p>Kecepatan Angin: <strong>${data.current.windSpeed}</strong></p>
            <p>Arah Angin: <strong>${data.current.windDirection}</strong></p>
            <p>Kondisi: <strong>${data.current.weatherDescription}</strong></p>
          `;
          lastUpdatedSpan.textContent=`${data.timestamp} (${data.location.timezone})`;
          window.location.hash=id;
        } catch(e) { console.error(e); weatherInfoDiv.innerHTML='<p class="error">Gagal memuat data cuaca</p>'; lastUpdatedSpan.textContent='Terjadi kesalahan'; }
      }

      locationSelect.addEventListener('change', e=>fetchWeather(e.target.value));
      await loadLocations();
    });
  </script>
</body>
</html>
