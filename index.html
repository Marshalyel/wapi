<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuaca Terkini Berbagai Lokasi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #e0f2f7; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin:0; color:#333; }
        .container { background:#fff; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.1); padding:30px 40px; text-align:center; width:90%; max-width:500px; }
        h1 { color:#007bb5; margin-bottom:20px; font-size:2em; }
        #location-select { padding:10px 15px; border-radius:8px; border:1px solid #ccc; margin-bottom:25px; font-size:1em; width:100%; max-width:300px; background-color:#f8f8f8; cursor:pointer; }
        #weather-info p { font-size:1.1em; margin:10px 0; }
        #weather-info strong { color:#005f88; }
        .loading { font-style:italic; color:#777; }
        .error { color:#d9534f; font-weight:bold; }
        .footer { margin-top:30px; font-size:0.8em; color:#888; }
    </style>
</head>
<body>
<div class="container">
    <h1>Cuaca Terkini di <span id="current-location-display"></span></h1>
    <select id="location-select"><option value="">Pilih Lokasi...</option></select>
    <div id="weather-info"><p class="loading">Pilih lokasi untuk melihat data cuaca.</p></div>
    <div class="footer">
        <p>Data diambil dari Open-Meteo melalui API GitHub Pages Anda.</p>
        <p>Terakhir diperbarui: <span id="last-updated">Belum diketahui</span></p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const API_BASE_URL = './api/';
    const locationsIndexURL = API_BASE_URL + 'locations.json';
    const locationSelect = document.getElementById('location-select');
    const weatherInfoDiv = document.getElementById('weather-info');
    const lastUpdatedSpan = document.getElementById('last-updated');
    const currentLocationDisplay = document.getElementById('current-location-display');

    async function loadLocationsIntoDropdown() {
        try {
            const response = await fetch(locationsIndexURL);
            const locations = await response.json();
            locations.forEach(loc => {
                const option = document.createElement('option');
                option.value = loc.id;
                option.textContent = loc.name;
                locationSelect.appendChild(option);
            });

            const initialLocationId = window.location.hash.substring(1);
            if (initialLocationId && locations.some(loc => loc.id === initialLocationId)) {
                locationSelect.value = initialLocationId;
                fetchWeatherData(initialLocationId);
            } else if (locations.length > 0) {
                locationSelect.value = locations[0].id;
                fetchWeatherData(locations[0].id);
            }

        } catch (error) {
            console.error(error);
            weatherInfoDiv.innerHTML = `<p class="error">Gagal memuat daftar lokasi.</p>`;
        }
    }

    async function fetchWeatherData(locationId) {
        const selectedOptionText = locationSelect.querySelector(`option[value="${locationId}"]`).textContent;
        currentLocationDisplay.textContent = selectedOptionText;
        weatherInfoDiv.innerHTML = `<p class="loading">Memuat data cuaca untuk ${selectedOptionText}...</p>`;
        lastUpdatedSpan.textContent = 'Memuat...';

        try {
            const API_URL = API_BASE_URL + locationId + '.json';
            const response = await fetch(API_URL);
            const data = await response.json();

            weatherInfoDiv.innerHTML = `
                <p>Suhu: <strong>${data.current.temperature}</strong></p>
                <p>Kondisi: <strong>${getWeatherConditionText(data.current.weatherCode)}</strong></p>
                <p>Kecepatan Angin: <strong>${data.current.windSpeed}</strong></p>
                <p>Arah Angin: <strong>${data.current.windDirection}</strong></p>
                <p>Siang Hari: <strong>${data.current.isDay}</strong></p>
            `;

            lastUpdatedSpan.textContent = `${data.timestamp} (${data.location.timezone})`;
            window.location.hash = locationId;

        } catch (error) {
            console.error(error);
            weatherInfoDiv.innerHTML = `<p class="error">Gagal memuat data cuaca untuk lokasi ini.</p>`;
            lastUpdatedSpan.textContent = 'Terjadi kesalahan';
        }
    }

    locationSelect.addEventListener('change', (event) => {
        const selectedLocationId = event.target.value;
        if (selectedLocationId) fetchWeatherData(selectedLocationId);
        else {
            weatherInfoDiv.innerHTML = `<p class="loading">Pilih lokasi untuk melihat data cuaca.</p>`;
            lastUpdatedSpan.textContent = 'Belum diketahui';
            currentLocationDisplay.textContent = '';
        }
    });

    await loadLocationsIntoDropdown();

    function getWeatherConditionText(code) {
        switch(code) {
            case 0: return 'Cerah';
            case 1: case 2: return 'Sebagian Berawan';
            case 3: return 'Berawan Penuh';
            case 45: return 'Berkabut';
            case 48: return 'Frost Fog';
            case 51: return 'Gerimis Ringan';
            case 53: return 'Gerimis Sedang';
            case 55: return 'Gerimis Lebat';
            case 56: return 'Gerimis Beku Ringan';
            case 57: return 'Gerimis Beku Lebat';
            case 61: return 'Hujan Ringan';
            case 63: return 'Hujan Sedang';
            case 65: return 'Hujan Lebat';
            case 66: return 'Hujan Beku Ringan';
            case 67: return 'Hujan Beku Lebat';
            case 71: return 'Salju Ringan';
            case 73: return 'Salju Sedang';
            case 75: return 'Salju Lebat';
            case 77: return 'Butiran Salju';
            case 80: return 'Hujan Ringan (Shower)';
            case 81: return 'Hujan Sedang (Shower)';
            case 82: return 'Hujan Lebat (Shower)';
            case 85: return 'Salju Ringan (Shower)';
            case 86: return 'Salju Lebat (Shower)';
            case 95: return 'Badai Petir';
            case 96: return 'Badai Petir dengan Hujan Es Ringan';
            case 99: return 'Badai Petir dengan Hujan Es Lebat';
            default: return 'Tidak Diketahui';
        }
    }
});
</script>
</body>
</html>
