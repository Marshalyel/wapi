<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cuaca Terkini BMKG</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; background:#e0f2f7; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; color:#333; }
.container { background:#fff; border-radius:15px; padding:30px 40px; text-align:center; width:90%; max-width:500px; box-shadow:0 10px 25px rgba(0,0,0,0.1);}
h1 { color:#007bb5; margin-bottom:20px; font-size:2em;}
#location-select {padding:10px 15px; border-radius:8px; border:1px solid #ccc; margin-bottom:25px; font-size:1em; width:100%; max-width:300px; background:#f8f8f8; cursor:pointer;}
#weather-info p {font-size:1.1em; margin:10px 0;}
#weather-info strong {color:#005f88;}
.loading {font-style:italic;color:#777;}
.error {color:#d9534f; font-weight:bold;}
.footer {margin-top:30px; font-size:0.8em; color:#888;}
</style>
</head>
<body>
<div class="container">
<h1>Cuaca Terkini di <span id="current-location-display"></span></h1>
<select id="location-select"><option value="">Pilih Lokasi...</option></select>
<div id="weather-info"><p class="loading">Pilih lokasi untuk melihat data cuaca.</p></div>
<div class="footer">
<p>Data diambil dari BMKG.</p>
<p>Terakhir diperbarui: <span id="last-updated">Belum diketahui</span></p>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const API_BASE = './api/';
  const select = document.getElementById('location-select');
  const info = document.getElementById('weather-info');
  const lastUpdated = document.getElementById('last-updated');
  const currentLoc = document.getElementById('current-location-display');

  let refreshInterval;

  async function loadLocations() {
    try {
      const res = await fetch(API_BASE + 'locations.json');
      const locations = await res.json();
      locations.forEach(loc => {
        const opt = document.createElement('option');
        opt.value = loc.id; opt.textContent = loc.name;
        select.appendChild(opt);
      });
      if(locations.length>0){
        select.value=locations[0].id;
        fetchWeather(locations[0].id);
      }
    } catch(e){
      info.innerHTML=`<p class="error">Gagal memuat daftar lokasi.</p>`;
    }
  }

  async function fetchWeather(id){
    const optText = select.querySelector(`option[value="${id}"]`).textContent;
    currentLoc.textContent = optText;
    info.innerHTML=`<p class="loading">Memuat data cuaca untuk ${optText}...</p>`;
    lastUpdated.textContent='Memuat...';

    try{
      const res = await fetch(API_BASE+id+'.json'); const data=await res.json();
      info.innerHTML=`
        <p>Kondisi: <strong>${data.current.weather}</strong></p>
        <p>Suhu: <strong>${data.current.temperature}</strong></p>
        <p>Kecepatan Angin: <strong>${data.current.windSpeed}</strong></p>
        <p>Arah Angin: <strong>${data.current.windDirection}</strong></p>
        <p>Waktu: <strong>${new Date(data.current.time).toLocaleTimeString('id-ID')}</strong></p>
      `;
      lastUpdated.textContent=new Date(data.timestamp).toLocaleString('id-ID',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
      window.location.hash=id;
    } catch(e){info.innerHTML=`<p class="error">Gagal memuat data cuaca.</p>`; lastUpdated.textContent='Terjadi kesalahan';}
  }

  select.addEventListener('change', e=>{
    if(e.target.value){
      fetchWeather(e.target.value);
      if(refreshInterval) clearInterval(refreshInterval);
      refreshInterval = setInterval(()=>fetchWeather(e.target.value), 5*60*1000); // refresh tiap 5 menit
    }
  });

  await loadLocations();

  // Set interval untuk default lokasi pertama
  if(select.value) refreshInterval = setInterval(()=>fetchWeather(select.value), 5*60*1000);
});
</script>
</body>
</html>
